#!/bin/bash

# Vineyard Costmap Web Application Demo Script
# This script demonstrates the complete React-based web application for vineyard costmap management

echo "ğŸ‡ Vineyard Costmap Web Application Demo ğŸ‡"
echo "=============================================="
echo ""

# Check if we're in the right directory
if [ ! -d "vineyard_costmap_web" ]; then
    echo "âŒ Error: Please run this script from the directory containing vineyard_costmap_web/"
    exit 1
fi

cd vineyard_costmap_web

echo "ğŸ“‹ System Overview:"
echo "==================="
echo "âœ… React Frontend with TypeScript and Material-UI"
echo "âœ… FastAPI Backend with PostgreSQL database"
echo "âœ… ROS2 Bridge integration via WebSocket"
echo "âœ… Docker containerization for easy deployment"
echo "âœ… Real-time costmap visualization with Leaflet"
echo "âœ… Parameter control panels for detection tuning"
echo "âœ… Processing job monitoring and management"
echo "âœ… Satellite imagery upload and management"
echo "âœ… User authentication and role-based access"
echo ""

echo "ğŸ—ï¸  Architecture Components:"
echo "============================="
echo "Frontend (React + TypeScript):"
echo "  - ğŸ“± Dashboard with system status"
echo "  - ğŸ—ºï¸  Interactive costmap viewer"
echo "  - ğŸ–¼ï¸  Satellite image management"
echo "  - âš™ï¸  Parameter control panels"
echo "  - ğŸ“Š Processing job monitoring"
echo "  - ğŸ¯ Mission planning interface"
echo ""
echo "Backend (FastAPI + Python):"
echo "  - ğŸ” Authentication and user management"
echo "  - ğŸ“‚ File upload and storage"
echo "  - ğŸ”„ ROS2 service integration"
echo "  - ğŸ“ˆ Job queue management"
echo "  - ğŸ’¾ Parameter preset storage"
echo ""
echo "ROS2 Integration:"
echo "  - ğŸŒ‰ WebSocket bridge via rosbridge_server"
echo "  - ğŸ› ï¸  Service calls to costmap generation"
echo "  - ğŸ“¡ Real-time topic subscriptions"
echo "  - ğŸ“Š System status monitoring"
echo ""

echo "ğŸ³ Docker Services:"
echo "==================="
echo "Services defined in docker-compose.yml:"
echo "  ğŸ˜ PostgreSQL Database (port 5432)"
echo "  ğŸƒ Redis Cache (port 6379)"
echo "  ğŸ–¥ï¸  Backend API Server (port 8000)"
echo "  ğŸŒ Frontend React App (port 3000)"
echo "  ğŸŒ‰ ROSbridge WebSocket Server (port 9090)"
echo ""

echo "ğŸ“ Project Structure:"
echo "====================="
echo "vineyard_costmap_web/"
echo "â”œâ”€â”€ frontend/                 # React TypeScript application"
echo "â”‚   â”œâ”€â”€ src/"
echo "â”‚   â”‚   â”œâ”€â”€ components/      # Reusable UI components"
echo "â”‚   â”‚   â”‚   â”œâ”€â”€ costmap/     # Costmap visualization"
echo "â”‚   â”‚   â”‚   â””â”€â”€ parameters/  # Parameter control panels"
echo "â”‚   â”‚   â”œâ”€â”€ services/        # API and ROS service clients"
echo "â”‚   â”‚   â”œâ”€â”€ hooks/           # Custom React hooks"
echo "â”‚   â”‚   â”œâ”€â”€ types/           # TypeScript type definitions"
echo "â”‚   â”‚   â””â”€â”€ pages/           # Application pages"
echo "â”‚   â”œâ”€â”€ public/              # Static assets"
echo "â”‚   â””â”€â”€ package.json         # Frontend dependencies"
echo "â”œâ”€â”€ backend/                 # FastAPI Python server"
echo "â”‚   â”œâ”€â”€ src/                 # Python source code"
echo "â”‚   â””â”€â”€ requirements.txt     # Python dependencies"
echo "â”œâ”€â”€ docker-compose.yml       # Multi-service deployment"
echo "â””â”€â”€ README.md                # Documentation"
echo ""

echo "ğŸ”§ Key Features Implemented:"
echo "============================="
echo ""
echo "1. ğŸ“Š Real-time Dashboard:"
echo "   - System status monitoring"
echo "   - Active job tracking"
echo "   - Service availability display"
echo "   - Connection status indicators"
echo ""
echo "2. ğŸ—ºï¸  Interactive Costmap Viewer:"
echo "   - Leaflet-based map display"
echo "   - Multi-layer visualization"
echo "   - Zoom and pan controls"
echo "   - Layer opacity adjustment"
echo "   - Cost value color coding"
echo ""
echo "3. ğŸ–¼ï¸  Satellite Image Management:"
echo "   - Drag-and-drop upload interface"
echo "   - GPS coordinate input"
echo "   - Image preview and metadata"
echo "   - Batch processing support"
echo ""
echo "4. âš™ï¸  Parameter Control System:"
echo "   - Row detection parameters"
echo "   - Costmap generation settings"
echo "   - Processing configuration"
echo "   - Preset save/load functionality"
echo ""
echo "5. ğŸ“ˆ Processing Job Monitor:"
echo "   - Real-time progress tracking"
echo "   - Job status visualization"
echo "   - Error reporting and logging"
echo "   - Queue management"
echo ""
echo "6. ğŸŒ‰ ROS2 Integration:"
echo "   - WebSocket communication"
echo "   - Service call handlers"
echo "   - Topic subscriptions"
echo "   - Connection management"
echo ""

echo "ğŸš€ Getting Started:"
echo "==================="
echo ""
echo "1. Prerequisites:"
echo "   âœ… Docker and Docker Compose"
echo "   âœ… Node.js 18+ (for development)"
echo "   âœ… Python 3.11+ (for development)"
echo "   âœ… ROS2 Jazzy (for ROS integration)"
echo ""
echo "2. Quick Start with Docker:"
echo "   $ cd vineyard_costmap_web"
echo "   $ docker-compose up -d"
echo "   $ open http://localhost:3000"
echo ""
echo "3. Development Setup:"
echo "   # Frontend"
echo "   $ cd frontend"
echo "   $ npm install"
echo "   $ npm run dev"
echo "   "
echo "   # Backend"
echo "   $ cd backend"
echo "   $ pip install -r requirements.txt"
echo "   $ python src/main.py"
echo "   "
echo "   # ROS2 Bridge"
echo "   $ ros2 launch rosbridge_server rosbridge_websocket_launch.xml"
echo ""

echo "ğŸ”Œ API Endpoints:"
echo "================="
echo "Authentication:"
echo "  POST /api/auth/login         # User login"
echo "  GET  /api/auth/me            # Current user info"
echo ""
echo "Satellite Images:"
echo "  POST /api/satellite-images   # Upload image"
echo "  GET  /api/satellite-images   # List images"
echo "  DELETE /api/satellite-images/{id}  # Delete image"
echo ""
echo "Costmaps:"
echo "  GET  /api/costmaps           # List costmaps"
echo "  GET  /api/costmaps/{id}      # Get costmap"
echo "  GET  /api/costmaps/{id}/export # Export costmap"
echo ""
echo "Processing Jobs:"
echo "  GET  /api/processing-jobs    # List jobs"
echo "  POST /api/processing-jobs/{id}/cancel # Cancel job"
echo ""
echo "Parameters:"
echo "  GET  /api/parameters/presets # List presets"
echo "  POST /api/parameters/presets # Save preset"
echo ""
echo "System:"
echo "  GET  /api/system/status      # System status"
echo ""

echo "ğŸŒ Web Interface Features:"
echo "=========================="
echo ""
echo "Dashboard Page:"
echo "  ğŸ“Š System status cards"
echo "  ğŸ“ˆ Processing job progress"
echo "  ğŸ”Œ Service availability"
echo "  ğŸ“± Responsive design"
echo ""
echo "Costmap Viewer:"
echo "  ğŸ—ºï¸  Interactive map with zoom/pan"
echo "  ğŸ¨ Layer visibility controls"
echo "  ğŸ“ Opacity adjustment sliders"
echo "  ğŸ“ Coordinate display"
echo "  ğŸ“Š Costmap information panel"
echo ""
echo "Image Upload:"
echo "  ğŸ“ Drag-and-drop interface"
echo "  ğŸŒ GPS bounds input"
echo "  ğŸ‘ï¸  Image preview"
echo "  ğŸ“‹ Metadata display"
echo ""
echo "Parameter Control:"
echo "  ğŸ”§ Real-time parameter adjustment"
echo "  ğŸ’¾ Preset save/load"
echo "  ğŸ”„ Default value reset"
echo "  âœ… Parameter validation"
echo ""

echo "ğŸ”— Integration with Existing ROS2 System:"
echo "=========================================="
echo ""
echo "The web application integrates with your existing ROS2 costmap system:"
echo ""
echo "âœ… Uses vineyard_mower_interfaces services:"
echo "   - GenerateCostmap.srv"
echo "   - UpdateCostmapLayer.srv"
echo "   - GetCostmapInfo.srv"
echo ""
echo "âœ… Connects to your costmap generation nodes:"
echo "   - satellite_processor.py"
echo "   - costmap_generator.py"
echo "   - costmap_service.py"
echo ""
echo "âœ… Subscribes to ROS2 topics:"
echo "   - /costmap/updates (nav_msgs/OccupancyGrid)"
echo "   - /costmap/job_updates (std_msgs/String)"
echo ""
echo "âœ… Compatible with your configuration:"
echo "   - Uses same parameter structure"
echo "   - Respects costmap format"
echo "   - Maintains ROS2 conventions"
echo ""

echo "ğŸ¯ Use Cases:"
echo "=============="
echo ""
echo "1. ğŸ§‘â€ğŸŒ¾ Farm Operator:"
echo "   - Upload satellite imagery of vineyard"
echo "   - Adjust detection parameters visually"
echo "   - Generate costmaps for navigation"
echo "   - Monitor processing progress"
echo "   - Export maps for field use"
echo ""
echo "2. ğŸ”¬ Agricultural Researcher:"
echo "   - Compare different parameter settings"
echo "   - Analyze detection algorithm performance"
echo "   - Batch process multiple field images"
echo "   - Export data for analysis"
echo ""
echo "3. ğŸ¤– System Administrator:"
echo "   - Monitor ROS2 system health"
echo "   - Manage processing job queues"
echo "   - Configure system parameters"
echo "   - Troubleshoot connectivity issues"
echo ""

echo "ğŸ“ Next Steps:"
echo "==============="
echo ""
echo "To complete the implementation:"
echo ""
echo "1. ğŸ—ï¸  Build the interfaces package:"
echo "   $ cd ../src/vineyard_mower_interfaces"
echo "   $ colcon build --packages-select vineyard_mower_interfaces"
echo ""
echo "2. ğŸš€ Start the web application:"
echo "   $ cd vineyard_costmap_web"
echo "   $ docker-compose up -d"
echo ""
echo "3. ğŸ”— Launch ROS2 costmap services:"
echo "   $ ros2 launch vineyard_mower_navigation costmap_generation.launch.py"
echo ""
echo "4. ğŸŒ Access the web interface:"
echo "   $ open http://localhost:3000"
echo ""
echo "5. ğŸ§ª Test the integration:"
echo "   - Upload a satellite image"
echo "   - Adjust detection parameters"
echo "   - Generate a costmap"
echo "   - View results in the map viewer"
echo ""

echo "âœ¨ The complete React-based web application is now ready!"
echo "ğŸ‡ Happy vineyard navigation! ğŸ‡"
